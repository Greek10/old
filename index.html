<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MiniGame Hub</title>
<style>
/* ===================== GLOBAL UI ===================== */
body {
    margin: 0;
    font-family: Poppins, sans-serif;
    background: #0a0f1e;
    color: white;
    overflow-x: hidden;
}
h1, h2, h3 { font-weight: 600; }

.title {
    text-align: center;
    margin-top: 25px;
    font-size: 40px;
    animation: fadeIn 1.2s ease;
}

.categories {
    display: flex;
    justify-content: center;
    margin: 20px;
    gap: 10px;
}
.categories button {
    padding: 10px 18px;
    background: #141d37;
    border: 0;
    color: #70c4ff;
    border-radius: 10px;
    transition: 0.25s;
}
.categories button:hover {
    background: #1e2a4d;
    transform: scale(1.05);
}

.game-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 20px;
    padding: 25px;
}

.game-card {
    background: #141d37;
    border-radius: 16px;
    padding: 20px;
    cursor: pointer;
    transition: 0.3s;
    box-shadow: 0 0 10px #0008;
}
.game-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0 20px #008aff;
}

/* ===================== LOADER ===================== */
.loader-screen {
    position: fixed;
    inset: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 200;
    transition: 0.6s;
}
@keyframes fadeIn {
    from {opacity: 0; transform: translateY(15px);}
    to {opacity: 1; transform: translateY(0);}
}

/* ===================== GAME PAGE ===================== */
.game-container {
    text-align: center;
    margin-top: 50px;
}

.back-btn {
    margin-top: 20px;
    padding: 12px 20px;
    background: #141d37;
    border: none;
    color: #70c4ff;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.25s;
}
.back-btn:hover {
    background: #1e2a4d;
    transform: scale(1.05);
}
</style>
</head>

<body>
<!-- ===================== LOADER ===================== -->
<div id="loader" class="loader-screen">
    <h2 style="font-size:32px; color:#70c4ff;">Loadingâ€¦</h2>
</div>

<!-- ===================== MAIN HUB ===================== -->
<div id="homePage">
    <header class="title">ðŸŽ® MiniGame Hub</header>

    <section class="categories">
        <button onclick="filterCategory('all')">All</button>
        <button onclick="filterCategory('skill')">Skill</button>
        <button onclick="filterCategory('logic')">Logic</button>
        <button onclick="filterCategory('reflex')">Reflex</button>
        <button onclick="filterCategory('puzzle')">Puzzle</button>
        <button onclick="filterCategory('arcade')">Arcade</button>
    </section>

    <div class="game-grid" id="gameGrid"></div>
</div>

<!-- ===================== GAME AREA ===================== -->
<div id="gamePage" style="display:none;"></div>

<script>
/* =============================================================
   SOUND ENGINE
============================================================= */
function playSound(s){}

/* =============================================================
   WEBHOOK ENGINE (send score)
============================================================= */
const WEBHOOK_URL = "https://ptb.discord.com/api/webhooks/1438771431772258355/8_yBf-nClQbjrYUACb43hTrP3ulqJBVUp9ekl_a9ejo8Zph38Z3Ub1ILBJVMpu-BKgbp";

async function sendScore(game, score) {
    await fetch(WEBHOOK_URL, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({ game, score, time:Date.now() })
    });
}

/* =============================================================
   MINIGAME LIST
============================================================= */
const games = [
    { name:"Aim Trainer", id:"aim", category:"skill" },
    { name:"Reaction Test", id:"react", category:"reflex" },
    { name:"Memory Cards", id:"memory", category:"puzzle" },
    { name:"Stealth Google Browser", id:"stealthBrowser", category:"arcade" }
];

/* =============================================================
   MINIGAME TEMPLATES (WITHOUT <script> TAGS)
============================================================= */

const gameTemplates = {
    aim: name => ({
        html: `
            <div class="game-container">
                <h1>${name}</h1>
                <p>Click the circle as fast as you can!</p>
                <div id="aimBox" style="width:120px;height:120px;border-radius:50%;background:red;margin:auto;cursor:pointer;"></div>
                <button class="back-btn" onclick="exitGame()">Back</button>
            </div>
        `,
        script: async function(){
            let start = Date.now();
            document.getElementById("aimBox").onclick = async () => {
                let score = Date.now() - start;
                alert("Your time: " + score + "ms");
                await sendScore("Aim Trainer", score);
                exitGame();
            };
        }
    }),

    react: name => ({
        html: `
            <div class="game-container">
                <h1>${name}</h1>
                <p>Click when the box turns green!</p>
                <div id="box" style="width:300px;height:300px;margin:auto;background:red;border-radius:20px;"></div>
                <button class="back-btn" onclick="exitGame()">Back</button>
            </div>
        `,
        script: async function(){
            let ready = false;
            let start;
            setTimeout(()=>{
                document.getElementById("box").style.background="green";
                start = Date.now();
                ready = true;
            }, Math.random()*2500 + 1000);

            document.getElementById("box").onclick = async () => {
                if(!ready) return;
                let score = Date.now() - start;
                alert("Reaction Time: " + score + "ms");
                await sendScore("Reaction Test", score);
                exitGame();
            };
        }
    }),

    memory: name => ({
        html: `
            <div class="game-container">
                <h1>${name}</h1>
                <p>Remember the pattern!</p>
                <button id="runBtn" class="back-btn">Start</button>
                <button class="back-btn" onclick="exitGame()">Back</button>
            </div>
        `,
        script: async function(){
            document.getElementById("runBtn").onclick = async ()=>{
                let score = Math.floor(Math.random()*10)+1;
                alert("Memory Score: " + score);
                await sendScore("Memory Cards", score);
                exitGame();
            };
        }
    }),

    stealthBrowser: name => ({
        html: `
            <div class="game-container">
                <h1>${name}</h1>
                <p>Use this lightweight window to open Google without sharing your main browser session or extensions.</p>
                <div style="display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin:20px auto;max-width:640px;">
                    <input id="stealthSearch" type="text" placeholder="Search the web or enter URL" style="flex:1;min-width:260px;padding:12px;border-radius:10px;border:none;" />
                    <button id="stealthGo" class="back-btn" style="min-width:100px;">Go</button>
                </div>
                <iframe id="stealthFrame" title="Stealth Google" src="https://www.google.com/webhp?igu=1"
                    style="width:90%;height:70vh;border-radius:18px;border:2px solid #141d37;background:white;"></iframe>
                <div style="margin-top:18px;display:flex;justify-content:center;gap:12px;flex-wrap:wrap;">
                    <button id="stealthHome" class="back-btn">Google Home</button>
                    <button class="back-btn" onclick="exitGame()">Back</button>
                </div>
            </div>
        `,
        script: function(){
            const iframe = document.getElementById("stealthFrame");
            const input = document.getElementById("stealthSearch");
            const goBtn = document.getElementById("stealthGo");
            const homeBtn = document.getElementById("stealthHome");

            const openTarget = () => {
                const query = input.value.trim();
                if(!query){
                    iframe.src = "https://www.google.com/webhp?igu=1";
                    return;
                }
                const looksLikeUrl = /^(https?:\/\/)/i.test(query) || query.includes(".");
                const destination = looksLikeUrl
                    ? (query.startsWith("http") ? query : `https://${query}`)
                    : `https://www.google.com/search?igu=1&q=${encodeURIComponent(query)}`;
                iframe.src = destination;
            };

            goBtn.onclick = openTarget;
            input.addEventListener("keydown", e => {
                if(e.key === "Enter") {
                    e.preventDefault();
                    openTarget();
                }
            });
            homeBtn.onclick = () => {
                iframe.src = "https://www.google.com/webhp?igu=1";
                input.value = "";
            };
        }
    })
};

/* =============================================================
   LOAD GAME (NOW EXECUTES SCRIPTS!)
============================================================= */
function loadGame(id, name) {
    document.getElementById("homePage").style.display = "none";

    const game = gameTemplates[id](name);

    const gp = document.getElementById("gamePage");
    gp.innerHTML = game.html;
    gp.style.display = "block";

    // Run game logic
    game.script();
}

function exitGame(){
    document.getElementById("gamePage").style.display = "none";
    document.getElementById("gamePage").innerHTML = "";
    document.getElementById("homePage").style.display = "block";
}

/* =============================================================
   RENDER GAME GRID
============================================================= */
function renderGames(filter="all") {
    const g = document.getElementById("gameGrid");
    g.innerHTML = "";

    games
      .filter(x => filter==="all" || x.category===filter)
      .forEach(x => {
        const d = document.createElement("div");
        d.className = "game-card";
        d.innerHTML = `<h3>${x.name}</h3>`;
        d.onclick = () => loadGame(x.id, x.name);
        g.appendChild(d);
      });
}

function filterCategory(c){ renderGames(c); }

/* =============================================================
   BOOT
============================================================= */
window.onload = () => {
    setTimeout(()=> {
        document.getElementById("loader").style.opacity = 0;
        setTimeout(()=>document.getElementById("loader").remove(), 600);
    }, 900);

    renderGames();
};
</script>
</body>
</html>
