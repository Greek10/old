<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Roblox Information Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0c0f1a;
  --card:#11162b;
  --accent:#ffb347;
  --accent2:#7cf2ff;
  --glow:0 16px 50px rgba(255,179,71,.25);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Fredoka", "Inter", system-ui, sans-serif;
  background:radial-gradient(circle at 10% 10%, rgba(255,179,71,.22), transparent 30%),
             radial-gradient(circle at 90% 0%, rgba(124,242,255,.18), transparent 32%),
             radial-gradient(circle at 25% 80%, rgba(255,114,182,.18), transparent 35%),
             #0b0f1f;
  color:#f7fbff;
  padding:26px 14px 48px;
}
h1{
  text-align:center;
  letter-spacing:1px;
  font-weight:800;
  margin:10px 0 18px;
  color:#ffe6b5;
  text-shadow:0 4px 0 rgba(0,0,0,.35);
}
nav{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  justify-content:center;
  margin-bottom:18px;
}
button{
  border-radius:12px;
  border:2px dashed rgba(255,179,71,.6);
  background:linear-gradient(135deg,rgba(255,179,71,.2),rgba(124,242,255,.18));
  color:#0f1424;
  padding:10px 16px;
  cursor:pointer;
  font-weight:700;
  font-size:13px;
  box-shadow:0 8px 0 rgba(0,0,0,.25);
}
button:hover,button.active{
  background:linear-gradient(135deg,rgba(255,179,71,.32),rgba(124,242,255,.28));
  transform:translateY(-1px);
  box-shadow:0 10px 0 rgba(0,0,0,.2);
}
input,textarea,select{
  background:#0c1227;
  border:1px solid rgba(255,179,71,.5);
  color:#ffe6c9;
  border-radius:10px;
  padding:8px 10px;
}
textarea{width:100%;min-height:120px;resize:vertical}
.controls{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin:10px 0;
}
.controls input,.controls select{flex:1;min-width:160px}
.section{
  display:none;
  background:rgba(15,19,40,.72);
  border-radius:16px;
  padding:14px;
  border:2px solid rgba(255,179,71,.22);
  box-shadow:var(--glow);
}
.section.active{display:block}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
  gap:12px;
  margin-top:10px;
}
.card{
  background:var(--card);
  border-radius:14px;
  padding:12px;
  border:1px solid rgba(255,179,71,.28);
  box-shadow:var(--glow);
}
.tag{
  display:inline-block;
  padding:2px 10px;
  border-radius:999px;
  font-size:11px;
  border:1px solid rgba(255,179,71,.55);
  color:#ffd7a0;
  margin-bottom:4px;
}
#suggestionsList{
  display:none;
  position:absolute;
  background:#050814;
  border:1px solid rgba(0,255,255,.3);
  border-radius:8px;
  margin-top:2px;
  width:100%;
  z-index:30;
  max-height:220px;
  overflow:auto;
}
.suggestion-item{
  padding:6px 8px;
  cursor:pointer;
  font-size:13px;
}
.suggestion-item:hover{background:#141c30}
#loadingOverlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:200;
}
.spinner{
  width:60px;height:60px;
  border-radius:50%;
  border:4px solid rgba(0,255,255,.2);
  border-top-color:var(--accent);
  animation:spin .7s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
#popupOverlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:150;
}
.popup{
  background:#0f1722;
  border-radius:12px;
  border:1px solid rgba(45,137,239,.4);
  padding:12px;
  width:92%;
  max-width:520px;
  max-height:80vh;
  overflow:auto;
}
.popup-item{
  padding:6px 4px;
  border-bottom:1px solid #151a2a;
  font-size:13px;
  cursor:pointer;
}
.popup-item:hover{color:var(--accent)}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th,td{
  border-bottom:1px solid rgba(230,237,243,.06);
  padding:4px 6px;
  text-align:left;
}
.badge-pill{
  display:inline-block;
  padding:2px 8px;
  border-radius:999px;
  font-size:11px;
  margin-right:4px;
}
.badge-ok{background:rgba(0,255,140,.16);border:1px solid rgba(0,255,140,.5)}
.badge-warn{background:rgba(255,180,0,.16);border:1px solid rgba(255,200,0,.6)}
.badge-bad{background:rgba(255,40,100,.16);border:1px solid rgba(255,60,140,.7)}
.outfit-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:6px}
.outfit-card{
  min-width:130px;
  background:#050814;
  border-radius:10px;
  padding:6px;
  border:1px solid rgba(255,179,71,.5);
  text-align:center;
  font-size:12px;
}
.outfit-card img{width:100%;border-radius:8px;display:block}
.small{font-size:12px;opacity:.85}
.profile-head{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.avatar-wrap{width:140px;height:140px;border-radius:16px;overflow:hidden;background:#0e1530;border:1px solid rgba(103,213,255,.35);display:flex;align-items:center;justify-content:center}
.avatar-wrap img{width:100%;height:100%;object-fit:cover;display:block}
</style>
</head>
<body>
<h1>Roblox Information Dashboard</h1>

<nav>
  <button data-section="profile" class="active">Profile</button>
  <button data-section="badgeboard">Badge Graph</button>
  <button data-section="gameinfo">Game Info</button>
  <button data-section="avatar">Avatar Evolution</button>
</nav>

<!-- PROFILE SECTION -->
<section id="profile" class="section active">
  <h2>Profile / Friends / Groups / Badges</h2>
  <div class="controls" style="position:relative">
    <input id="rbxUser" placeholder="Roblox username">
    <button id="rbxFetch">Fetch Profile</button>
    <div id="suggestionsList"></div>
  </div>
  <div id="rbxResults" class="grid"></div>
</section>

<!-- BADGE GRAPH -->
<section id="badgeboard" class="section">
  <h2>Badge Timeline Graph</h2>
  <p class="small">Enter a Roblox username and we will plot every badge they own in the order it was awarded.</p>
  <div class="controls">
    <input id="bgUser" placeholder="Roblox username">
    <button id="bgLoad">Graph Badges</button>
  </div>
  <div id="lbResult" style="margin-top:12px"></div>
  <canvas id="badgeCanvas" width="900" height="420" style="width:100%;max-width:960px;background:#0b1124;border-radius:12px;border:1px dashed rgba(255,179,71,.35);display:none"></canvas>
</section>

<!-- GAME INFO -->
<section id="gameinfo" class="section">
  <h2>Game Info (Game ID → Details)</h2>
  <p class="small">Enter a game (universe) ID to see title, creator, player counts, visits, favorites, and vote ratios.</p>
  <div class="controls">
    <input id="giGameId" placeholder="Game ID (e.g. 606849621)">
    <button id="giLoad">Get Info</button>
  </div>
  <div id="giResult" class="card"></div>
</section>

<!-- AVATAR EVOLUTION -->
<section id="avatar" class="section">
  <h2>Avatar Evolution (Saved Outfits)</h2>
  <p class="small">Loads saved outfits via avatar API (public via roproxy) and shows thumbnails from Roblox thumbnails API.</p>
  <div class="controls">
    <input id="avUser" placeholder="Username">
    <button id="avLoad">Load Outfits</button>
  </div>
  <div id="avResult" style="margin-top:12px"></div>
</section>

<!-- POPUP -->
<div id="popupOverlay">
  <div class="popup">
    <h3 id="popupTitle"></h3>
    <input id="popupSearch" placeholder="Filter..." style="width:100%;margin-bottom:8px">
    <div id="popupContent"></div>
    <button onclick="closePopup()" style="margin-top:8px">Close</button>
  </div>
</div>

<!-- LOADING -->
<div id="loadingOverlay"><div class="spinner"></div></div>

<script>
// ---------- helpers ----------
const proxyWrap = u => `https://corsproxy.io/?${encodeURIComponent(u)}`;
async function fetchJson(url,opts){
  const res = await fetch(url,{mode:'cors',credentials:'omit',...opts});
  if(!res.ok) throw new Error(`HTTP ${res.status}`);
  return res.json();
}
async function tryMulti(urls,opts){
  for(const u of urls){
    try{ return await fetchJson(u,opts); }catch{}
  }
  return null;
}

// ---------- section nav ----------
document.querySelectorAll('nav button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const id = btn.dataset.section;
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('nav button').forEach(b=>b.classList.toggle('active',b===btn));
  });
});

// ---------- popup ----------
const popupOverlay = document.getElementById('popupOverlay');
const popupTitle = document.getElementById('popupTitle');
const popupContent = document.getElementById('popupContent');
const popupSearch = document.getElementById('popupSearch');
let popupItems = [], popupClick = null;
function showPopup(title,items,onClick){
  popupItems = items;
  popupClick = onClick || null;
  popupTitle.textContent = title;
  renderPopup(items);
  popupSearch.value='';
  popupOverlay.style.display='flex';
}
function renderPopup(list){
  popupContent.innerHTML = list.map(v=>`<div class="popup-item" data-v="${v}">${v}</div>`).join('');
  popupContent.querySelectorAll('.popup-item').forEach(el=>{
    el.onclick = ()=>{ if(popupClick) popupClick(el.dataset.v); };
  });
}
popupSearch.oninput = ()=>{
  const q = popupSearch.value.toLowerCase();
  renderPopup(popupItems.filter(v=>v.toLowerCase().includes(q)));
};
function closePopup(){ popupOverlay.style.display='none'; }

// ---------- loading ----------
const loading = document.getElementById('loadingOverlay');
const setLoading = on => loading.style.display = on?'flex':'none';

// ---------- lookup user ----------
const usernameEndpoints = [
  'https://users.roproxy.com/v1/usernames/users',
  'https://users.rprxy.xyz/v1/usernames/users',
  proxyWrap('https://users.roblox.com/v1/usernames/users')
];
async function lookupUser(name){
  const payload = {usernames:[name],excludeBannedUsers:false};
  for(const url of usernameEndpoints){
    try{
      const data = await fetchJson(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
      if(data?.data?.length) return data.data[0];
    }catch{}
  }
  throw new Error('Unable to reach Roblox user services.');
}

// separate: get full profile by id
async function getUserProfile(id){
  return await tryMulti([
    `https://users.roproxy.com/v1/users/${id}`,
    `https://users.rprxy.xyz/v1/users/${id}`,
    proxyWrap(`https://users.roblox.com/v1/users/${id}`)
  ]);
}

// ---------- profile section ----------
const rbxInput = document.getElementById('rbxUser');
const rbxResults = document.getElementById('rbxResults');
const suggList = document.getElementById('suggestionsList');
let suggTimer=null;

rbxInput.oninput = ()=>{
  const q = rbxInput.value.trim();
  if(suggTimer) clearTimeout(suggTimer);
  if(q.length<3){ suggList.style.display='none'; return; }
  suggTimer = setTimeout(()=>searchSuggest(q),220);
};
async function searchSuggest(q){
  try{
    const data = await fetchJson(proxyWrap(`https://users.roblox.com/v1/users/search?keyword=${encodeURIComponent(q)}&limit=10`));
    if(!data?.data?.length){suggList.style.display='none';return;}
    suggList.innerHTML = data.data.map(u=>`<div class="suggestion-item" data-u="${u.name}">${u.displayName} (@${u.name})</div>`).join('');
    suggList.style.display='block';
    suggList.querySelectorAll('.suggestion-item').forEach(el=>{
      el.onclick = ()=>{rbxInput.value=el.dataset.u;suggList.style.display='none';renderProfile(el.dataset.u);};
    });
  }catch{ suggList.style.display='none'; }
}
document.getElementById('rbxFetch').onclick = ()=>renderProfile(rbxInput.value.trim());

async function renderProfile(username){
  if(!username) return;
  rbxResults.innerHTML = `<div class="card">Loading profile for <b>${username}</b>...</div>`;
  setLoading(true);
  try{
    const user = await lookupUser(username);
    const id = user.id;
    const profile = await getUserProfile(id);
    const friends = await tryMulti([
      `https://friends.roproxy.com/v1/users/${id}/friends?limit=200`,
      `https://friends.rprxy.xyz/v1/users/${id}/friends?limit=200`,
      proxyWrap(`https://friends.roblox.com/v1/users/${id}/friends?limit=200`)
    ]);
    const groups = await tryMulti([
      `https://groups.roproxy.com/v2/users/${id}/groups/roles`,
      `https://groups.rprxy.xyz/v2/users/${id}/groups/roles`,
      proxyWrap(`https://groups.roblox.com/v2/users/${id}/groups/roles`)
    ]);
    const badges = await tryMulti([
      `https://badges.roproxy.com/v1/users/${id}/badges?limit=100`,
      `https://badges.rprxy.xyz/v1/users/${id}/badges?limit=100`,
      proxyWrap(`https://badges.roblox.com/v1/users/${id}/badges?limit=100`)
    ]);

    const friendsList = (friends?.data||[]).map(f=>f.name);
    const groupsList = (groups?.data||[]).map(g=>`${g.group.name} — ${g.role?.name||'Member'}`);
    const badgeList = (badges?.data||[]).map(b=>b.name);

    rbxResults.innerHTML = '';

    const profileCard = document.createElement('div');
    profileCard.className='card';
    profileCard.innerHTML = `
      <h3>Profile</h3>
      <div class="profile-head">
        <div class="avatar-wrap" id="avatarSlot"><span class="small">Avatar preview ready</span></div>
        <div>
          <span class="tag">ID: ${id}</span><br>
          <b>${profile.displayName}</b><br>@${profile.name}<br>
          Created: ${profile.created? new Date(profile.created).toLocaleDateString(): 'Unknown'}<br>
          Description: <span class="small">${profile.description || '(none)'}</span>
        </div>
      </div>
    `;

    const avatarBtn = document.createElement('button');
    avatarBtn.textContent = 'Show Avatar';
    avatarBtn.style.marginTop = '10px';
    avatarBtn.onclick = ()=>loadAvatar(id, profile.name);
    profileCard.appendChild(avatarBtn);
    rbxResults.appendChild(profileCard);

    function makeCard(title,body,list,onClickName){
      const c = document.createElement('div');
      c.className='card';
      c.innerHTML = `<h3>${title}</h3><p>${body}</p>`;
      if(list && list.length){
        const btn = document.createElement('button');
        btn.textContent='Show All';
        btn.onclick=()=>showPopup(title,list,onClickName);
        c.appendChild(btn);
      }
      rbxResults.appendChild(c);
    }

    makeCard('Friends',friendsList.slice(0,6).join(', ')||'None',friendsList,name=>renderProfile(name));
    makeCard('Groups',groupsList.slice(0,5).join('<br>')||'None',groupsList,null);
    if(badgeList.length) makeCard('Badges',badgeList.slice(0,5).join(', '),badgeList,null);

  }catch(err){
    rbxResults.innerHTML = `<div class="card"><h3>Error</h3><p>${err.message}</p></div>`;
  }
  setLoading(false);
}

async function loadAvatar(id, username){
  const slot = document.getElementById('avatarSlot');
  if(!slot) return;
  slot.textContent = 'Loading avatar...';
  try{
    const data = await tryMulti([
      `https://thumbnails.roproxy.com/v1/users/avatar?userIds=${id}&size=420x420&format=Png&isCircular=false`,
      proxyWrap(`https://thumbnails.roblox.com/v1/users/avatar?userIds=${id}&size=420x420&format=Png&isCircular=false`)
    ]);
    const url = data?.data?.[0]?.imageUrl;
    slot.innerHTML = url ? `<img src="${url}" alt="Avatar for ${username}">` : '<span class="small">No avatar preview available.</span>';
  }catch(err){
    slot.innerHTML = `<span class="small">Avatar preview failed: ${err.message}</span>`;
  }
}

// ---------- badge graph ----------
document.getElementById('bgLoad').onclick = ()=>graphBadges();

async function graphBadges(){
  const username = document.getElementById('bgUser').value.trim();
  const box = document.getElementById('lbResult');
  const canvas = document.getElementById('badgeCanvas');
  const ctx = canvas.getContext('2d');
  canvas.style.display='none';
  if(!username){box.innerHTML='<div class="card">Enter a username to graph their badges.</div>';return;}
  box.innerHTML='<div class="card">Loading badges...</div>';
  setLoading(true);
  try{
    const user = await lookupUser(username);
    const id = user.id;
    let cursor = null;
    const badges = [];
    let safety = 0;
    while(safety < 12){
      const urlBase = cursor ?
        [`https://badges.roproxy.com/v1/users/${id}/badges?limit=100&cursor=${cursor}`,
         proxyWrap(`https://badges.roblox.com/v1/users/${id}/badges?limit=100&cursor=${cursor}`)]:
        [`https://badges.roproxy.com/v1/users/${id}/badges?limit=100&sortOrder=Desc`,
         proxyWrap(`https://badges.roblox.com/v1/users/${id}/badges?limit=100&sortOrder=Desc`)];
      const data = await tryMulti(urlBase);
      if(!data?.data?.length) break;
      badges.push(...data.data);
      cursor = data.nextPageCursor;
      if(!cursor) break;
      safety++;
    }

    if(!badges.length){
      box.innerHTML = `<div class="card"><h3>No badges found</h3><p>${username} does not have public badges.</p></div>`;
      setLoading(false);
      return;
    }

    const dated = badges
      .filter(b=>b.awardedDate)
      .map(b=>({
        name:b.name,
        date:new Date(b.awardedDate)
      }))
      .sort((a,b)=>a.date-b.date);

    if(!dated.length){
      box.innerHTML = `<div class="card"><h3>No award dates</h3><p>Badges for ${username} did not return award dates to plot.</p></div>`;
      setLoading(false);
      return;
    }

    const points = dated.map((b,i)=>({x:b.date, y:i+1}));
    drawBadgeGraph(ctx, points, username);
    canvas.style.display='block';
    const first = dated[0].date.toLocaleDateString();
    const last = dated[dated.length-1].date.toLocaleDateString();
    box.innerHTML = `<div class="card"><h3>${username}'s Badge Timeline</h3><p class="small">${dated.length} badges from ${first} to ${last}</p></div>`;
  }catch(err){
    box.innerHTML = `<div class="card"><h3>Error</h3><p>${err.message}</p></div>`;
  }
  setLoading(false);
}

function drawBadgeGraph(ctx, points, username){
  const w = ctx.canvas.width;
  const h = ctx.canvas.height;
  ctx.clearRect(0,0,w,h);
  const pad = 46;
  const maxY = points[points.length-1].y;
  const minX = points[0].x.getTime();
  const maxX = points[points.length-1].x.getTime();
  const spread = Math.max(maxX - minX, 1);

  // background doodle
  const grad = ctx.createLinearGradient(0,0,w,h);
  grad.addColorStop(0,'rgba(255,179,71,0.18)');
  grad.addColorStop(1,'rgba(124,242,255,0.18)');
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,w,h);

  // axes
  ctx.strokeStyle = 'rgba(255,230,181,0.8)';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(pad,h-pad);
  ctx.lineTo(w-pad,h-pad);
  ctx.moveTo(pad,h-pad);
  ctx.lineTo(pad,pad);
  ctx.stroke();

  // labels
  ctx.fillStyle = '#ffe6b5';
  ctx.font = '12px Inter, sans-serif';
  ctx.fillText('Badges', pad-10, pad-12);
  ctx.fillText('Time', w-pad-20, h-pad+26);
  ctx.font = '14px Fredoka, sans-serif';
  ctx.fillText(`${username} badge journey`, pad, pad-20);

  ctx.strokeStyle = 'rgba(255,179,71,0.9)';
  ctx.lineWidth = 3;
  ctx.beginPath();
  points.forEach((p,i)=>{
    const x = pad + ((p.x.getTime()-minX)/spread) * (w - pad*2);
    const y = h - pad - (p.y/maxY) * (h - pad*2);
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.stroke();

  ctx.fillStyle = '#0f1424';
  ctx.strokeStyle = '#7cf2ff';
  points.forEach(p=>{
    const x = pad + ((p.x.getTime()-minX)/spread) * (w - pad*2);
    const y = h - pad - (p.y/maxY) * (h - pad*2);
    ctx.beginPath();
    ctx.arc(x,y,4,0,Math.PI*2);
    ctx.fill();
    ctx.stroke();
  });
}

// ---------- game info (universe id) ----------
document.getElementById('giLoad').onclick = ()=>loadGameInfo();

async function loadGameInfo(){
  const gameId = document.getElementById('giGameId').value.trim();
  const box = document.getElementById('giResult');
  if(!gameId){box.innerHTML='<div class="small">Enter a game ID to continue.</div>';return;}

  box.innerHTML='<div class="small">Fetching game details...</div>';
  setLoading(true);
  try{
    const gameData = await tryMulti([
      `https://games.roproxy.com/v1/games?universeIds=${gameId}`,
      `https://games.rprxy.xyz/v1/games?universeIds=${gameId}`,
      proxyWrap(`https://games.roblox.com/v1/games?universeIds=${gameId}`)
    ]);
    const game = gameData?.data?.[0];
    if(!game) throw new Error('No data found for that game ID.');

    const voteData = await tryMulti([
      `https://games.roproxy.com/v1/games/votes?universeIds=${gameId}`,
      `https://games.rprxy.xyz/v1/games/votes?universeIds=${gameId}`,
      proxyWrap(`https://games.roblox.com/v1/games/votes?universeIds=${gameId}`)
    ]);
    const votes = voteData?.data?.[0] || {};
    const likeRatio = votes.downVotes === 0 && votes.upVotes === 0 ? 'No votes yet' : `${Math.round((votes.upVotes/(votes.upVotes+votes.downVotes))*100)}%`;

    const fields = [
      {label:'Creator', value:`${game.creator?.name||'Unknown'} (ID: ${game.creator?.id||'—'})`},
      {label:'Genre', value:game.genre || 'Unknown'},
      {label:'Playing Now', value:game.playing?.toLocaleString() || '0'},
      {label:'Total Visits', value:game.visits?.toLocaleString() || '0'},
      {label:'Favorites', value:game.favoritedCount?.toLocaleString() || '0'},
      {label:'Like Ratio', value:likeRatio}
    ];

    const rows = fields.map(f=>`<tr><th style="width:140px">${f.label}</th><td>${f.value}</td></tr>`).join('');

    box.innerHTML = `
      <div class="card">
        <h3>${game.name || 'Unknown Title'}</h3>
        <p class="small">Game ID: ${gameId}</p>
        <table>${rows}</table>
        <p class="small" style="margin-top:8px">Last updated: ${game.updated ? new Date(game.updated).toLocaleString() : 'Unknown'}</p>
        ${game.description ? `<p class="small">${game.description}</p>` : ''}
      </div>
    `;
  }catch(err){
    box.innerHTML=`<div class="card"><h3>Error</h3><p>${err.message}</p></div>`;
  }
  setLoading(false);
}

// ---------- avatar evolution / outfits ----------
document.getElementById('avLoad').onclick = async()=>{
  const username = document.getElementById('avUser').value.trim();
  const box = document.getElementById('avResult');
  if(!username){box.innerHTML='<div class="card">Enter a username.</div>';return;}
  box.innerHTML='<div class="card">Loading outfits...</div>';
  setLoading(true);
  try{
    const user = await lookupUser(username);
    const id = user.id;
    const outfits = await tryMulti([
      `https://avatar.roproxy.com/v1/users/${id}/outfits?itemsPerPage=50&page=1`,
      proxyWrap(`https://avatar.roblox.com/v1/users/${id}/outfits?itemsPerPage=50&page=1`)
    ]);
    if(!outfits?.data?.length){box.innerHTML='<div class="card">No public outfits found.</div>';setLoading(false);return;}
    const ids = outfits.data.map(o=>o.id).slice(0,50);
    const thumbData = await tryMulti([
      `https://thumbnails.roproxy.com/v1/users/outfits?userOutfitIds=${ids.join(',')}&size=150x150&format=Png&isCircular=false`,
      proxyWrap(`https://thumbnails.roblox.com/v1/users/outfits?userOutfitIds=${ids.join(',')}&size=150x150&format=Png&isCircular=false`)
    ]);
    const mapThumb = {};
    (thumbData?.data||[]).forEach(t=>{mapThumb[t.targetId]=t.imageUrl;});
    let html = `<div class="card"><h3>Outfits for ${username}</h3><div class="outfit-row">`;
    outfits.data.forEach(o=>{
      const url = mapThumb[o.id] || '';
      html += `
        <div class="outfit-card">
          ${url?`<img src="${url}" alt="${o.name}">`:''}
          <div>${o.name}</div>
          <div class="small">Outfit ID: ${o.id}</div>
        </div>
      `;
    });
    html += '</div><p class="small">These are saved outfits – basically an avatar evolution list.</p></div>';
    box.innerHTML = html;
  }catch(err){
    box.innerHTML = `<div class="card"><h3>Error</h3><p>${err.message}</p></div>`;
  }
  setLoading(false);
};

</script>
</body>
</html>
