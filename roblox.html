
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Roblox Information Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0c1024;
  --card:#131a32;
  --accent:#67d5ff;
  --accent2:#ff7ad1;
  --glow:0 20px 60px rgba(103,213,255,.18);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:radial-gradient(160% 120% at 10% 20%,rgba(255,122,209,.08),transparent 50%),
             radial-gradient(140% 90% at 80% 0%,rgba(103,213,255,.12),transparent 45%),
             linear-gradient(145deg,#0c0f25,#111939);
  color:#e9f2ff;
  padding:28px 16px 48px;
}
h1{
  text-align:center;
  letter-spacing:1px;
  font-weight:800;
  margin:10px 0 22px;
}
nav{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  justify-content:center;
  margin-bottom:18px;
}
button{
  border-radius:10px;
  border:1px solid rgba(103,213,255,.5);
  background:linear-gradient(135deg,rgba(103,213,255,.14),rgba(255,122,209,.18));
  color:#f6fbff;
  padding:10px 15px;
  cursor:pointer;
  font-weight:600;
  font-size:13px;
}
button:hover,button.active{
  background:linear-gradient(135deg,rgba(103,213,255,.26),rgba(255,122,209,.3));
  box-shadow:0 0 20px rgba(103,213,255,.35);
}
input,textarea,select{
  background:#0e1530;
  border:1px solid rgba(103,213,255,.45);
  color:#e6edf3;
  border-radius:10px;
  padding:8px 10px;
}
textarea{width:100%;min-height:120px;resize:vertical}
.controls{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin:10px 0;
}
.controls input,.controls select{flex:1;min-width:160px}
.section{
  display:none;
  background:rgba(12,16,36,.5);
  border-radius:14px;
  padding:14px;
  border:1px solid rgba(230,237,243,.08);
  box-shadow:var(--glow);
}
.section.active{display:block}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
  gap:12px;
  margin-top:10px;
}
.card{
  background:var(--card);
  border-radius:12px;
  padding:12px;
  border:1px solid rgba(230,237,243,.06);
  box-shadow:var(--glow);
}
.tag{
  display:inline-block;
  padding:2px 10px;
  border-radius:999px;
  font-size:11px;
  border:1px solid rgba(45,137,239,.45);
  color:#b7d6ff;
  margin-bottom:4px;
}
#suggestionsList{
  display:none;
  position:absolute;
  background:#050814;
  border:1px solid rgba(0,255,255,.3);
  border-radius:8px;
  margin-top:2px;
  width:100%;
  z-index:30;
  max-height:220px;
  overflow:auto;
}
.suggestion-item{
  padding:6px 8px;
  cursor:pointer;
  font-size:13px;
}
.suggestion-item:hover{background:#141c30}
#loadingOverlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:200;
}
.spinner{
  width:60px;height:60px;
  border-radius:50%;
  border:4px solid rgba(0,255,255,.2);
  border-top-color:var(--accent);
  animation:spin .7s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
#popupOverlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:150;
}
.popup{
  background:#0f1722;
  border-radius:12px;
  border:1px solid rgba(45,137,239,.4);
  padding:12px;
  width:92%;
  max-width:520px;
  max-height:80vh;
  overflow:auto;
}
.popup-item{
  padding:6px 4px;
  border-bottom:1px solid #151a2a;
  font-size:13px;
  cursor:pointer;
}
.popup-item:hover{color:var(--accent)}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th,td{
  border-bottom:1px solid rgba(230,237,243,.06);
  padding:4px 6px;
  text-align:left;
}
.badge-pill{
  display:inline-block;
  padding:2px 8px;
  border-radius:999px;
  font-size:11px;
  margin-right:4px;
}
.badge-ok{background:rgba(0,255,140,.16);border:1px solid rgba(0,255,140,.5)}
.badge-warn{background:rgba(255,180,0,.16);border:1px solid rgba(255,200,0,.6)}
.badge-bad{background:rgba(255,40,100,.16);border:1px solid rgba(255,60,140,.7)}
.outfit-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:6px}
.outfit-card{
  min-width:130px;
  background:#050814;
  border-radius:10px;
  padding:6px;
  border:1px solid rgba(0,255,255,.3);
  text-align:center;
  font-size:12px;
}
.outfit-card img{width:100%;border-radius:8px;display:block}
.small{font-size:12px;opacity:.85}
.profile-head{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.avatar-wrap{width:140px;height:140px;border-radius:16px;overflow:hidden;background:#0e1530;border:1px solid rgba(103,213,255,.35);display:flex;align-items:center;justify-content:center}
.avatar-wrap img{width:100%;height:100%;object-fit:cover;display:block}
</style>
</head>
<body>
<h1>Roblox Information Dashboard</h1>

<nav>
  <button data-section="profile" class="active">Profile</button>
  <button data-section="badgeboard">Badge Leaderboard</button>
  <button data-section="gameinfo">Game Info</button>
  <button data-section="avatar">Avatar Evolution</button>
</nav>

<!-- PROFILE SECTION -->
<section id="profile" class="section active">
  <h2>Profile / Friends / Groups / Badges</h2>
  <div class="controls" style="position:relative">
    <input id="rbxUser" placeholder="Roblox username">
    <button id="rbxFetch">Fetch Profile</button>
    <div id="suggestionsList"></div>
  </div>
  <div id="rbxResults" class="grid"></div>
</section>

<!-- BADGE LEADERBOARD -->
<section id="badgeboard" class="section">
  <h2>Badge Leaderboard (Custom List)</h2>
  <p class="small">Enter a badge ID and a list of usernames. This checks who owns the badge and sorts them by award date (fastest at top).</p>
  <div class="controls">
    <input id="lbBadgeId" placeholder="Badge ID">
  </div>
  <div class="controls">
    <textarea id="lbUsernames" placeholder="One username per line"></textarea>
  </div>
  <button id="lbScan">Scan List</button>
  <div id="lbResult" style="margin-top:12px"></div>
</section>

<!-- GAME INFO -->
<section id="gameinfo" class="section">
  <h2>Game Info (Game ID → Details)</h2>
  <p class="small">Enter a game (universe) ID to see title, creator, player counts, visits, favorites, and vote ratios.</p>
  <div class="controls">
    <input id="giGameId" placeholder="Game ID (e.g. 606849621)">
    <button id="giLoad">Get Info</button>
  </div>
  <div id="giResult" class="card"></div>
</section>

<!-- AVATAR EVOLUTION -->
<section id="avatar" class="section">
  <h2>Avatar Evolution (Saved Outfits)</h2>
  <p class="small">Loads saved outfits via avatar API (public via roproxy) and shows thumbnails from Roblox thumbnails API.</p>
  <div class="controls">
    <input id="avUser" placeholder="Username">
    <button id="avLoad">Load Outfits</button>
  </div>
  <div id="avResult" style="margin-top:12px"></div>
</section>

<!-- POPUP -->
<div id="popupOverlay">
  <div class="popup">
    <h3 id="popupTitle"></h3>
    <input id="popupSearch" placeholder="Filter..." style="width:100%;margin-bottom:8px">
    <div id="popupContent"></div>
    <button onclick="closePopup()" style="margin-top:8px">Close</button>
  </div>
</div>

<!-- LOADING -->
<div id="loadingOverlay"><div class="spinner"></div></div>

<script>
// ---------- helpers ----------
const proxyWrap = u => `https://corsproxy.io/?${encodeURIComponent(u)}`;
async function fetchJson(url,opts){
  const res = await fetch(url,{mode:'cors',credentials:'omit',...opts});
  if(!res.ok) throw new Error(`HTTP ${res.status}`);
  return res.json();
}
async function tryMulti(urls,opts){
  for(const u of urls){
    try{ return await fetchJson(u,opts); }catch{}
  }
  return null;
}

// ---------- section nav ----------
document.querySelectorAll('nav button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const id = btn.dataset.section;
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('nav button').forEach(b=>b.classList.toggle('active',b===btn));
  });
});

// ---------- popup ----------
const popupOverlay = document.getElementById('popupOverlay');
const popupTitle = document.getElementById('popupTitle');
const popupContent = document.getElementById('popupContent');
const popupSearch = document.getElementById('popupSearch');
let popupItems = [], popupClick = null;
function showPopup(title,items,onClick){
  popupItems = items;
  popupClick = onClick || null;
  popupTitle.textContent = title;
  renderPopup(items);
  popupSearch.value='';
  popupOverlay.style.display='flex';
}
function renderPopup(list){
  popupContent.innerHTML = list.map(v=>`<div class="popup-item" data-v="${v}">${v}</div>`).join('');
  popupContent.querySelectorAll('.popup-item').forEach(el=>{
    el.onclick = ()=>{ if(popupClick) popupClick(el.dataset.v); };
  });
}
popupSearch.oninput = ()=>{
  const q = popupSearch.value.toLowerCase();
  renderPopup(popupItems.filter(v=>v.toLowerCase().includes(q)));
};
function closePopup(){ popupOverlay.style.display='none'; }

// ---------- loading ----------
const loading = document.getElementById('loadingOverlay');
const setLoading = on => loading.style.display = on?'flex':'none';

// ---------- lookup user ----------
const usernameEndpoints = [
  'https://users.roproxy.com/v1/usernames/users',
  'https://users.rprxy.xyz/v1/usernames/users',
  proxyWrap('https://users.roblox.com/v1/usernames/users')
];
async function lookupUser(name){
  const payload = {usernames:[name],excludeBannedUsers:false};
  for(const url of usernameEndpoints){
    try{
      const data = await fetchJson(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
      if(data?.data?.length) return data.data[0];
    }catch{}
  }
  throw new Error('Unable to reach Roblox user services.');
}

// separate: get full profile by id
async function getUserProfile(id){
  return await tryMulti([
    `https://users.roproxy.com/v1/users/${id}`,
    `https://users.rprxy.xyz/v1/users/${id}`,
    proxyWrap(`https://users.roblox.com/v1/users/${id}`)
  ]);
}

// ---------- profile section ----------
const rbxInput = document.getElementById('rbxUser');
const rbxResults = document.getElementById('rbxResults');
const suggList = document.getElementById('suggestionsList');
let suggTimer=null;

rbxInput.oninput = ()=>{
  const q = rbxInput.value.trim();
  if(suggTimer) clearTimeout(suggTimer);
  if(q.length<3){ suggList.style.display='none'; return; }
  suggTimer = setTimeout(()=>searchSuggest(q),220);
};
async function searchSuggest(q){
  try{
    const data = await fetchJson(proxyWrap(`https://users.roblox.com/v1/users/search?keyword=${encodeURIComponent(q)}&limit=10`));
    if(!data?.data?.length){suggList.style.display='none';return;}
    suggList.innerHTML = data.data.map(u=>`<div class="suggestion-item" data-u="${u.name}">${u.displayName} (@${u.name})</div>`).join('');
    suggList.style.display='block';
    suggList.querySelectorAll('.suggestion-item').forEach(el=>{
      el.onclick = ()=>{rbxInput.value=el.dataset.u;suggList.style.display='none';renderProfile(el.dataset.u);};
    });
  }catch{ suggList.style.display='none'; }
}
document.getElementById('rbxFetch').onclick = ()=>renderProfile(rbxInput.value.trim());

async function renderProfile(username){
  if(!username) return;
  rbxResults.innerHTML = `<div class="card">Loading profile for <b>${username}</b>...</div>`;
  setLoading(true);
  try{
    const user = await lookupUser(username);
    const id = user.id;
    const profile = await getUserProfile(id);
    const friends = await tryMulti([
      `https://friends.roproxy.com/v1/users/${id}/friends?limit=200`,
      `https://friends.rprxy.xyz/v1/users/${id}/friends?limit=200`,
      proxyWrap(`https://friends.roblox.com/v1/users/${id}/friends?limit=200`)
    ]);
    const groups = await tryMulti([
      `https://groups.roproxy.com/v2/users/${id}/groups/roles`,
      `https://groups.rprxy.xyz/v2/users/${id}/groups/roles`,
      proxyWrap(`https://groups.roblox.com/v2/users/${id}/groups/roles`)
    ]);
    const badges = await tryMulti([
      `https://badges.roproxy.com/v1/users/${id}/badges?limit=100`,
      `https://badges.rprxy.xyz/v1/users/${id}/badges?limit=100`,
      proxyWrap(`https://badges.roblox.com/v1/users/${id}/badges?limit=100`)
    ]);

    const friendsList = (friends?.data||[]).map(f=>f.name);
    const groupsList = (groups?.data||[]).map(g=>`${g.group.name} — ${g.role?.name||'Member'}`);
    const badgeList = (badges?.data||[]).map(b=>b.name);

    rbxResults.innerHTML = '';

    const profileCard = document.createElement('div');
    profileCard.className='card';
    profileCard.innerHTML = `
      <h3>Profile</h3>
      <div class="profile-head">
        <div class="avatar-wrap" id="avatarSlot"><span class="small">Avatar preview ready</span></div>
        <div>
          <span class="tag">ID: ${id}</span><br>
          <b>${profile.displayName}</b><br>@${profile.name}<br>
          Created: ${profile.created? new Date(profile.created).toLocaleDateString(): 'Unknown'}<br>
          Description: <span class="small">${profile.description || '(none)'}</span>
        </div>
      </div>
    `;

    const avatarBtn = document.createElement('button');
    avatarBtn.textContent = 'Show Avatar';
    avatarBtn.style.marginTop = '10px';
    avatarBtn.onclick = ()=>loadAvatar(id, profile.name);
    profileCard.appendChild(avatarBtn);
    rbxResults.appendChild(profileCard);

    function makeCard(title,body,list,onClickName){
      const c = document.createElement('div');
      c.className='card';
      c.innerHTML = `<h3>${title}</h3><p>${body}</p>`;
      if(list && list.length){
        const btn = document.createElement('button');
        btn.textContent='Show All';
        btn.onclick=()=>showPopup(title,list,onClickName);
        c.appendChild(btn);
      }
      rbxResults.appendChild(c);
    }

    makeCard('Friends',friendsList.slice(0,6).join(', ')||'None',friendsList,name=>renderProfile(name));
    makeCard('Groups',groupsList.slice(0,5).join('<br>')||'None',groupsList,null);
    if(badgeList.length) makeCard('Badges',badgeList.slice(0,5).join(', '),badgeList,null);

  }catch(err){
    rbxResults.innerHTML = `<div class="card"><h3>Error</h3><p>${err.message}</p></div>`;
  }
  setLoading(false);
}

async function loadAvatar(id, username){
  const slot = document.getElementById('avatarSlot');
  if(!slot) return;
  slot.textContent = 'Loading avatar...';
  try{
    const data = await tryMulti([
      `https://thumbnails.roproxy.com/v1/users/avatar?userIds=${id}&size=420x420&format=Png&isCircular=false`,
      proxyWrap(`https://thumbnails.roblox.com/v1/users/avatar?userIds=${id}&size=420x420&format=Png&isCircular=false`)
    ]);
    const url = data?.data?.[0]?.imageUrl;
    slot.innerHTML = url ? `<img src="${url}" alt="Avatar for ${username}">` : '<span class="small">No avatar preview available.</span>';
  }catch(err){
    slot.innerHTML = `<span class="small">Avatar preview failed: ${err.message}</span>`;
  }
}

// ---------- badge leaderboard ----------
document.getElementById('lbScan').onclick = async()=>{
  const badgeId = Number(document.getElementById('lbBadgeId').value.trim());
  const raw = document.getElementById('lbUsernames').value.split(/\r?\n/).map(v=>v.trim()).filter(Boolean);
  const box = document.getElementById('lbResult');
  if(!badgeId || !raw.length){box.innerHTML='<div class="card">Enter badge ID and at least one username.</div>';return;}
  box.innerHTML='<div class="card">Scanning list...</div>';
  setLoading(true);
  const results = [];
  for(const name of raw){
    try{
      const u = await lookupUser(name);
      const id = u.id;
      const data = await tryMulti([
        `https://badges.roproxy.com/v1/users/${id}/badges/awarded-dates?badgeIds=${badgeId}`,
        `https://badges.rprxy.xyz/v1/users/${id}/badges/awarded-dates?badgeIds=${badgeId}`,
        proxyWrap(`https://badges.roblox.com/v1/users/${id}/badges/awarded-dates?badgeIds=${badgeId}`)
      ]);
      const entry = data?.data?.find(x=>String(x.badgeId)===String(badgeId));
      if(entry) results.push({name, id, date:new Date(entry.awardedDate)});
    }catch{}
  }
  setLoading(false);
  if(!results.length){box.innerHTML='<div class="card">None of these users own that badge.</div>';return;}
  results.sort((a,b)=>a.date-b.date);
  let html = `<div class="card"><h3>Owners (${results.length})</h3><table><tr><th>#</th><th>User</th><th>UserId</th><th>Awarded</th></tr>`;
  results.forEach((r,i)=>{
    html += `<tr><td>${i+1}</td><td>${r.name}</td><td>${r.id}</td><td>${r.date.toLocaleString()}</td></tr>`;
  });
  html+='</table></div>';
  box.innerHTML=html;
};

// ---------- game info (universe id) ----------
document.getElementById('giLoad').onclick = ()=>loadGameInfo();

async function loadGameInfo(){
  const gameId = document.getElementById('giGameId').value.trim();
  const box = document.getElementById('giResult');
  if(!gameId){box.innerHTML='<div class="small">Enter a game ID to continue.</div>';return;}

  box.innerHTML='<div class="small">Fetching game details...</div>';
  setLoading(true);
  try{
    const gameData = await tryMulti([
      `https://games.roproxy.com/v1/games?universeIds=${gameId}`,
      `https://games.rprxy.xyz/v1/games?universeIds=${gameId}`,
      proxyWrap(`https://games.roblox.com/v1/games?universeIds=${gameId}`)
    ]);
    const game = gameData?.data?.[0];
    if(!game) throw new Error('No data found for that game ID.');

    const voteData = await tryMulti([
      `https://games.roproxy.com/v1/games/votes?universeIds=${gameId}`,
      `https://games.rprxy.xyz/v1/games/votes?universeIds=${gameId}`,
      proxyWrap(`https://games.roblox.com/v1/games/votes?universeIds=${gameId}`)
    ]);
    const votes = voteData?.data?.[0] || {};
    const likeRatio = votes.downVotes === 0 && votes.upVotes === 0 ? 'No votes yet' : `${Math.round((votes.upVotes/(votes.upVotes+votes.downVotes))*100)}%`;

    const fields = [
      {label:'Creator', value:`${game.creator?.name||'Unknown'} (ID: ${game.creator?.id||'—'})`},
      {label:'Genre', value:game.genre || 'Unknown'},
      {label:'Playing Now', value:game.playing?.toLocaleString() || '0'},
      {label:'Total Visits', value:game.visits?.toLocaleString() || '0'},
      {label:'Favorites', value:game.favoritedCount?.toLocaleString() || '0'},
      {label:'Like Ratio', value:likeRatio}
    ];

    const rows = fields.map(f=>`<tr><th style="width:140px">${f.label}</th><td>${f.value}</td></tr>`).join('');

    box.innerHTML = `
      <div class="card">
        <h3>${game.name || 'Unknown Title'}</h3>
        <p class="small">Game ID: ${gameId}</p>
        <table>${rows}</table>
        <p class="small" style="margin-top:8px">Last updated: ${game.updated ? new Date(game.updated).toLocaleString() : 'Unknown'}</p>
        ${game.description ? `<p class="small">${game.description}</p>` : ''}
      </div>
    `;
  }catch(err){
    box.innerHTML=`<div class="card"><h3>Error</h3><p>${err.message}</p></div>`;
  }
  setLoading(false);
}

// ---------- avatar evolution / outfits ----------
document.getElementById('avLoad').onclick = async()=>{
  const username = document.getElementById('avUser').value.trim();
  const box = document.getElementById('avResult');
  if(!username){box.innerHTML='<div class="card">Enter a username.</div>';return;}
  box.innerHTML='<div class="card">Loading outfits...</div>';
  setLoading(true);
  try{
    const user = await lookupUser(username);
    const id = user.id;
    const outfits = await tryMulti([
      `https://avatar.roproxy.com/v1/users/${id}/outfits?itemsPerPage=50&page=1`,
      proxyWrap(`https://avatar.roblox.com/v1/users/${id}/outfits?itemsPerPage=50&page=1`)
    ]);
    if(!outfits?.data?.length){box.innerHTML='<div class="card">No public outfits found.</div>';setLoading(false);return;}
    const ids = outfits.data.map(o=>o.id).slice(0,50);
    const thumbData = await tryMulti([
      `https://thumbnails.roproxy.com/v1/users/outfits?userOutfitIds=${ids.join(',')}&size=150x150&format=Png&isCircular=false`,
      proxyWrap(`https://thumbnails.roblox.com/v1/users/outfits?userOutfitIds=${ids.join(',')}&size=150x150&format=Png&isCircular=false`)
    ]);
    const mapThumb = {};
    (thumbData?.data||[]).forEach(t=>{mapThumb[t.targetId]=t.imageUrl;});
    let html = `<div class="card"><h3>Outfits for ${username}</h3><div class="outfit-row">`;
    outfits.data.forEach(o=>{
      const url = mapThumb[o.id] || '';
      html += `
        <div class="outfit-card">
          ${url?`<img src="${url}" alt="${o.name}">`:''}
          <div>${o.name}</div>
          <div class="small">Outfit ID: ${o.id}</div>
        </div>
      `;
    });
    html += '</div><p class="small">These are saved outfits – basically an avatar evolution list.</p></div>';
    box.innerHTML = html;
  }catch(err){
    box.innerHTML = `<div class="card"><h3>Error</h3><p>${err.message}</p></div>`;
  }
  setLoading(false);
};

</script>
</body>
</html>
