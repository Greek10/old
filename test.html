<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Just Shapes & Beats â€“ Mobile Version</title>

<style>
  body,html{
    margin:0; padding:0; overflow:hidden;
    background:linear-gradient(135deg,#090909,#111); color:white;
    font-family:Arial, sans-serif;
    user-select:none;
    touch-action:none;
  }
  canvas{ display:block; }

  /* Health bar */
  #healthBar{
    position:absolute; top:10px; left:50%; transform:translateX(-50%);
    width:300px; height:25px; border-radius:8px;
    background:#333; border:2px solid #666;
  }
  #healthFill{
    width:100%; height:100%;
    background:#0f0; border-radius:6px;
  }

  /* Ability buttons */
  .abilityBtn{
    position:absolute; bottom:20px;
    width:70px; height:70px; border-radius:12px;
    border:2px solid #777; background:#222; color:white;
    font-size:14px;
  }
  #btn1{ right:20px; }
  #btn2{ right:100px; }
  #btn3{ right:180px; }

  /* Joystick */
  #joystickOuter{
    position:absolute; bottom:20px; left:20px;
    width:140px; height:140px; border-radius:50%;
    background:rgba(255,255,255,0.05);
    border:2px solid #555;
    touch-action:none;
  }
  #joystickInner{
    position:absolute; width:60px; height:60px; border-radius:50%;
    background:#888; top:40px; left:40px;
    touch-action:none;
  }
</style>
</head>
<body>

<div id="healthBar"><div id="healthFill"></div></div>

<!-- Mobile controls -->
<div id="joystickOuter"><div id="joystickInner"></div></div>

<button id="btn1" class="abilityBtn">Shield</button>
<button id="btn2" class="abilityBtn">Clear</button>
<button id="btn3" class="abilityBtn">Restore</button>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

/* -----------------------
       PLAYER
-------------------------*/
let player = {
  x: canvas.width/2,
  y: canvas.height/2,
  size: 40,
  speed: 4,
  vx: 0, vy: 0,
  health: 100,
  shieldActive: false
};

/* -----------------------
       ABILITY COOLDOWNS
-------------------------*/
let ability = {
  shield: { cd: 45, timer: 0, duration: 5, active:false },
  clear:  { cd:120, timer:0 },
  restore:{ cd:90,  timer:0 }
};

function useShield(){
  if(ability.shield.timer <= 0){
    ability.shield.active = true;
    player.shieldActive = true;
    ability.shield.timer = ability.shield.cd;
    setTimeout(()=>{ player.shieldActive=false }, ability.shield.duration*1000);
  }
}
function useClear(){
  if(ability.clear.timer <= 0){
    objects = [];
    ability.clear.timer = ability.clear.cd;
  }
}
function useRestore(){
  if(ability.restore.timer <= 0){
    player.health = Math.min(100, player.health + 50);
    ability.restore.timer = ability.restore.cd;
  }
}

document.getElementById("btn1").onclick = useShield;
document.getElementById("btn2").onclick = useClear;
document.getElementById("btn3").onclick = useRestore;

/* -----------------------
       MOBILE JOYSTICK
-------------------------*/
const joyOuter = document.getElementById("joystickOuter");
const joyInner = document.getElementById("joystickInner");

let joyActive = false, joyX = 0, joyY = 0;

joyOuter.addEventListener("touchstart", e=>{
  joyActive = true;
});
joyOuter.addEventListener("touchend", e=>{
  joyActive = false;
  joyInner.style.left = "40px";
  joyInner.style.top = "40px";
  player.vx = player.vy = 0;
});
joyOuter.addEventListener("touchmove", e=>{
  let rect = joyOuter.getBoundingClientRect();
  let touch = e.touches[0];

  let dx = touch.clientX - (rect.left + rect.width/2);
  let dy = touch.clientY - (rect.top + rect.height/2);

  let dist = Math.sqrt(dx*dx + dy*dy);
  let max = 50;

  if(dist > max){
    dx = dx/dist * max;
    dy = dy/dist * max;
  }

  joyInner.style.left = (40 + dx) + "px";
  joyInner.style.top  = (40 + dy) + "px";

  player.vx = (dx/max) * player.speed;
  player.vy = (dy/max) * player.speed;
});

/* -----------------------
       OBJECTS (Enemies)
-------------------------*/
let objects = [];
let spawnTimer = 0;

function spawnObject(){
  let type = Math.random() < 0.5 ? "circle" : "exploder";
  objects.push({
    x: Math.random()*canvas.width,
    y: -40,
    size: 30,
    type: type,
    cooldown: 0
  });
}

/* -----------------------
       GAME LOOP
-------------------------*/
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* Move player */
  player.x += player.vx;
  player.y += player.vy;

  /* Boundaries */
  player.x = Math.max(player.size, Math.min(canvas.width-player.size, player.x));
  player.y = Math.max(player.size, Math.min(canvas.height-player.size, player.y));

  /* Draw player */
  ctx.fillStyle = player.shieldActive ? "#0ff" : "#0af";
  ctx.fillRect(player.x-player.size/2, player.y-player.size/2, player.size, player.size);

  /* Spawn objects */
  spawnTimer++;
  if(spawnTimer >= 50){
    spawnObject();
    spawnTimer = 0;
  }

  /* Update objects */
  objects.forEach((o, i)=>{
    o.y += 2;

    if(o.type === "exploder"){
      o.cooldown++;
      if(o.cooldown > 120){
        // explosion bullets
        for(let k=0;k<8;k++){
          bullets.push({
            x:o.x, y:o.y,
            vx:Math.cos(k*0.78)*3,
            vy:Math.sin(k*0.78)*3,
            size:10
          });
        }
        objects.splice(i,1);
      }
    }

    ctx.fillStyle = o.type === "exploder" ? "#f0f" : "#f33";
    ctx.beginPath();
    ctx.arc(o.x, o.y, o.size, 0, Math.PI*2);
    ctx.fill();

    // collision
    let dx = player.x - o.x;
    let dy = player.y - o.y;
    if(Math.sqrt(dx*dx+dy*dy) < player.size){
      if(!player.shieldActive){
        player.health -= 0.2;
      }
    }
  });

  /* Bullets from enemies */
  bullets.forEach((b,i)=>{
    b.x += b.vx;
    b.y += b.vy;

    ctx.fillStyle="#fff";
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.size,0,Math.PI*2);
    ctx.fill();

    let dx = player.x - b.x;
    let dy = player.y - b.y;

    if(Math.sqrt(dx*dx+dy*dy) < player.size){
      if(!player.shieldActive){
        player.health -= 0.3;
      }
    }
  });

  // Update health bar
  document.getElementById("healthFill").style.width = player.health+"%";

  /* Cooldowns */
  if(ability.shield.timer > 0) ability.shield.timer -= 1/60;
  if(ability.clear.timer > 0) ability.clear.timer -= 1/60;
  if(ability.restore.timer > 0) ability.restore.timer -= 1/60;

  requestAnimationFrame(loop);
}

let bullets = [];
loop();
</script>

</body>
</html>
